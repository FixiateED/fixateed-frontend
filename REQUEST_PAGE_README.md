# صفحة الطلبات - Fixate Repair Request Page

## نظرة عامة

صفحة طلبات الإصلاح هي نموذج متعدد الخطوات (Multi-step Form) يسمح للعملاء بحجز خدمات إصلاح الأجهزة الإلكترونية.

## المميزات

### 1. نموذج متعدد الخطوات
- **الخطوة 1**: اختيار معلومات الجهاز (الشركة المصنعة، الموديل، نوع الخدمة)
- **الخطوة 2**: إدخال معلومات التواصل والموقع
- **الخطوة 3**: صفحة التأكيد بعد الإرسال الناجح

### 2. التحقق من البيانات
- التحقق من صحة جميع الحقول المطلوبة
- التحقق من صحة رقم الجوال (10 أرقام على الأقل)
- التحقق من صحة البريد الإلكتروني
- رسائل خطأ واضحة باللغة العربية

### 3. الشركات المصنعة المدعومة
- **آبل (Apple)**: iPhone, MacBook, iPad
- **سامسونج (Samsung)**: Galaxy S, Galaxy Z Fold, Galaxy Tab
- **هواوي (Huawei)**: P Series, Mate Series, MateBook
- **ديل (Dell)**: XPS, Inspiron
- **إتش بي (HP)**: Spectre, Envy, Pavilion
- **لينوفو (Lenovo)**: ThinkPad, Yoga, IdeaPad

### 4. أنواع الخدمات
#### للجوالات والتابلت:
- تغيير الشاشة
- تغيير البطارية
- إصلاح منفذ الشحن
- إصلاح الكاميرا
- إصلاح السماعة
- مشكلة أخرى

#### للابتوبات:
- تغيير الشاشة
- تغيير البطارية
- إصلاح الكيبورد
- حل مشاكل البرامج
- تنظيف وصيانة
- مشكلة أخرى

## التثبيت والإعداد

### 1. إعداد قاعدة البيانات

قم بتشغيل ملف SQL في Supabase:

\`\`\`bash
# افتح Supabase Dashboard
# اذهب إلى SQL Editor
# انسخ محتوى ملف database/repair_requests.sql
# قم بتشغيل الاستعلام
\`\`\`

أو استخدم Supabase CLI:

\`\`\`bash
supabase db push
\`\`\`

### 2. إعداد متغيرات البيئة

تأكد من وجود ملف `.env.local` يحتوي على:

\`\`\`env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
\`\`\`

### 3. تشغيل المشروع

\`\`\`bash
# تثبيت الحزم
npm install

# تشغيل في وضع التطوير
npm run dev

# بناء للإنتاج
npm run build
npm start
\`\`\`

## بنية الملفات

\`\`\`
fixateed-frontend/
├── pages/
│   ├── request.js          # صفحة الطلبات الرئيسية
│   ├── index.js            # الصفحة الرئيسية
│   └── api/
│       └── generate-plan.js
├── lib/
│   ├── supabaseClient.js   # إعداد Supabase
│   └── pages/
│       └── new-child.js
├── database/
│   └── repair_requests.sql # SQL لإنشاء الجدول
└── package.json
\`\`\`

## استخدام الصفحة

### 1. الوصول إلى الصفحة
\`\`\`
https://your-domain.com/request
\`\`\`

### 2. تدفق المستخدم

1. **اختيار الشركة المصنعة**: يختار المستخدم الشركة (آبل، سامسونج، إلخ)
2. **اختيار الموديل**: يظهر قائمة بالموديلات المتاحة للشركة المختارة
3. **اختيار الخدمة**: يختار نوع الإصلاح المطلوب
4. **إدخال البيانات**: يدخل الاسم، رقم الجوال، المدينة، إلخ
5. **الإرسال**: يتم حفظ الطلب في قاعدة البيانات
6. **التأكيد**: تظهر رسالة نجاح مع تفاصيل الخطوات التالية

## قاعدة البيانات

### جدول repair_requests

| العمود | النوع | الوصف |
|--------|------|-------|
| id | BIGSERIAL | المعرف الفريد |
| brand | VARCHAR(50) | مفتاح الشركة المصنعة |
| brand_name | VARCHAR(100) | اسم الشركة بالعربية |
| model | VARCHAR(100) | مفتاح الموديل |
| model_name | VARCHAR(200) | اسم الموديل |
| service | VARCHAR(100) | مفتاح الخدمة |
| service_name | VARCHAR(200) | اسم الخدمة بالعربية |
| service_other | TEXT | وصف المشكلة (إذا اختار "أخرى") |
| customer_name | VARCHAR(200) | اسم العميل |
| customer_phone | VARCHAR(20) | رقم الجوال |
| customer_email | VARCHAR(200) | البريد الإلكتروني |
| city | VARCHAR(100) | المدينة |
| address | TEXT | العنوان التفصيلي |
| notes | TEXT | ملاحظات إضافية |
| status | VARCHAR(50) | حالة الطلب |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### حالات الطلب (Status)

- `pending`: قيد الانتظار (الحالة الافتراضية)
- `confirmed`: تم التأكيد
- `in_progress`: جاري العمل
- `completed`: مكتمل
- `cancelled`: ملغي

## الأمان

### Row Level Security (RLS)

تم تفعيل RLS مع السياسات التالية:

1. **السماح بالإدراج للجميع**: يمكن لأي شخص إرسال طلب جديد
2. **السماح بالقراءة للمصادق عليهم فقط**: فقط المستخدمين المسجلين يمكنهم قراءة الطلبات
3. **السماح بالتحديث للمصادق عليهم فقط**: فقط المستخدمين المسجلين يمكنهم تحديث الطلبات

## التخصيص

### إضافة شركة مصنعة جديدة

في ملف `pages/request.js`، أضف إلى كائن `BRANDS`:

\`\`\`javascript
const BRANDS = {
  // ... الشركات الموجودة
  xiaomi: {
    name: 'شاومي',
    nameEn: 'Xiaomi',
    models: [
      { id: 'mi-13-pro', name: 'Mi 13 Pro', category: 'phone' },
      // ... المزيد من الموديلات
    ]
  }
};
\`\`\`

### إضافة خدمة جديدة

في ملف `pages/request.js`، أضف إلى كائن `SERVICES`:

\`\`\`javascript
const SERVICES = {
  phone: [
    // ... الخدمات الموجودة
    { id: 'water-damage', name: 'إصلاح أضرار المياه' }
  ]
};
\`\`\`

## استكشاف الأخطاء

### المشكلة: لا يتم إرسال الطلب

**الحل:**
1. تحقق من إعدادات Supabase في `.env.local`
2. تأكد من تشغيل SQL لإنشاء الجدول
3. تحقق من سياسات RLS في Supabase Dashboard
4. افتح Console في المتصفح للبحث عن أخطاء JavaScript

### المشكلة: خطأ 503 أو 500

**الحل:**
1. تأكد من أن خدمة Supabase تعمل
2. تحقق من صحة مفاتيح API
3. تأكد من أن الجدول موجود في قاعدة البيانات
4. تحقق من سياسات RLS

### المشكلة: النموذج لا يتحقق من البيانات

**الحل:**
1. تأكد من أن دالة `validateStep` تعمل بشكل صحيح
2. تحقق من رسائل الخطأ في `errors` state
3. تأكد من أن جميع الحقول المطلوبة محددة بشكل صحيح

## الدعم

للمساعدة أو الإبلاغ عن مشاكل، يرجى فتح issue في GitHub أو التواصل مع فريق التطوير.

## الترخيص

هذا المشروع مرخص تحت رخصة MIT.
